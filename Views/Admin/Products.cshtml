@model GiftLab.ViewModels.Admin.AdminProductIndexViewModel
@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Products";
}

<div class="container-fluid p-4 p-lg-5">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">Sản phẩm</h1>
            <p class="text-muted mb-0">Quản lý sản phẩm và danh mục.</p>
        </div>
        <div class="d-flex gap-2">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                <i class="bi bi-plus-lg me-2"></i>
                Thêm
            </button>
            <button type="button" class="btn btn-outline-secondary"
                    id="exportProductsBtn"
                    data-bs-toggle="tooltip"
                    title="Xuất dữ liệu">
                <i class="bi bi-download icon-hover"></i>
            </button>

            <button type="button" class="btn btn-outline-secondary"
                    data-bs-toggle="modal"
                    data-bs-target="#filterProductModal"
                    title="Lọc">
                <i class="bi bi-funnel icon-hover"></i>
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-lg-6">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="stats-icon bg-primary bg-opacity-10 text-primary">
                                <i class="bi bi-box"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0 text-muted">Tổng sản phẩm</h6>
                            <h3 class="mb-0">@Model.TotalProducts</h3>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> +12.5%
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="stats-icon bg-success bg-opacity-10 text-success">
                                <i class="bi bi-check-circle"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0 text-muted">Đang hoạt động</h6>
                            <h3 class="mb-0">@Model.ActiveProducts</h3>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> +8.2%
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="stats-icon bg-warning bg-opacity-10 text-warning">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0 text-muted">Hết hàng</h6>
                            <h3 class="mb-0">@Model.OutOfStockProducts</h3>
                            <small class="text-danger">
                                <i class="bi bi-arrow-down"></i> -2.1%
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card stats-card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="stats-icon bg-info bg-opacity-10 text-info">
                                <i class="bi bi-tags"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-0 text-muted">Danh mục</h6>
                            <h3 class="mb-0">@Model.TotalCategories</h3>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> +5.4%
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Tất cả sản phẩm</h5>
            <div class="input-group" style="width: 300px;">
                <input type="text" class="form-control" placeholder="Tìm kiếm sản phẩm..." id="productSearch">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Danh mục</th>
                            <th>Giá</th>
                            <th>Tồn kho</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var p in Model.Products)
                        {
                            <tr class="product-row"
                                data-name="@p.Name.ToLower()"
                                data-category="@p.Category.ToLower()">

                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="@p.ImagePath" width="40" height="40"
                                             class="me-2 rounded" style="object-fit:cover" />
                                        <div>
                                            <div class="fw-semibold">@p.Name</div>
                                            <small class="text-muted">ID: #@p.Id</small>
                                        </div>
                                    </div>
                                </td>
                                <td>@p.Category</td>
                                <td>@p.Price.ToString("N0") ₫</td>
                                <td>@p.Stock</td>
                                <td>
                                    @if (p.Stock > 0)
                                    {
                                        <span class="badge bg-success">Còn hàng</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Hết hàng</span>
                                    }
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-info"
                                            data-bs-toggle="modal"
                                            data-bs-target="#viewProductModal"
                                            data-product-id="@p.Id"
                                            data-product-name="@p.Name"
                                            data-product-category="@p.Category"
                                            data-product-price="@p.Price"
                                            data-product-stock="@p.Stock"
                                            data-product-status="@(p.Stock > 0 ? "In Stock" : "Out of Stock")"
                                            data-product-image="@p.ImagePath"
                                            data-product-description="@p.Description">
                                        <i class="bi bi-eye"></i>
                                    </button>

                                    <button class="btn btn-sm btn-outline-primary"
                                            data-bs-toggle="modal"
                                            data-bs-target="#editProductModal"
                                            data-id="@p.Id"
                                            data-name="@p.Name"
                                            data-category="@p.Category"
                                            data-price="@p.Price"
                                            data-stock="@p.Stock"
                                            data-active="@p.Active"
                                            data-description="@p.Description"
                                            data-shortdesc="@p.ShortDesc"
                                            data-image="@p.ImagePath">
                                        <i class="bi bi-pencil"></i>
                                    </button>

                                    <button class="btn btn-sm btn-outline-danger"
                                            data-bs-toggle="modal"
                                            data-bs-target="#deleteProductModal"
                                            data-id="@p.Id"
                                            data-name="@p.Name">
                                        <i class="bi bi-trash"></i>
                                    </button>

                                </td>
                            </tr>
                        }
                    </tbody>

                </table>
            </div>
            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center" id="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Trước</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Sau</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">
                    <i class="bi bi-plus-circle me-2"></i>Thêm sản phẩm mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addProductForm" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addProductName" class="form-label">Tên sản phẩm <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addProductName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="addProductCategory" class="form-label">Danh mục <span class="text-danger">*</span></label>
                            <select class="form-select" id="addProductCategory" required>
                                <option value="0">Chọn danh mục...</option>
                                <option value="1">Cupcake</option>
                                <option value="2">Cookie</option>
                                <option value="3">Tart</option>
                                <option value="4">Chocolate</option>
                                <option value="5">Đất màu</option>
                                <option value="6">Len mềm</option>
                                <option value="7">Hạt cườm</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addProductPrice" class="form-label">Giá <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="addProductPrice" min="0" step="1000" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="addProductStock" class="form-label">Số lượng tồn kho <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="addProductStock" min="0" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="addProductStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="addProductStatus">
                            <option value="In Stock" selected>Còn hàng</option>
                            <option value="Out of Stock">Hết hàng</option>
                            <option value="Low Stock">Sắp hết hàng</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="addProductShortDesc" class="form-label">Mô tả ngắn</label>
                        <input type="text" class="form-control" id="addProductShortDesc" placeholder="Mô tả ngắn gọn về sản phẩm...">
                    </div>
                    <div class="mb-3">
                        <label for="addProductDescription" class="form-label">Mô tả chi tiết</label>
                        <textarea class="form-control" id="addProductDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="addProductImage" class="form-label">Hình ảnh</label>
                        <input type="file" class="form-control" id="addProductImage" accept="image/*">
                        <div class="mt-2">
                            <img id="addProductImagePreview" src="" alt="Preview" style="max-width: 200px; max-height: 200px; display: none; border-radius: 8px; border: 1px solid #dee2e6;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="handleAddProduct()">Thêm sản phẩm</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProductModalLabel">
                    <i class="bi bi-pencil me-2"></i>Chỉnh sửa sản phẩm
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editProductForm">
                    <input type="hidden" id="editProductId">
                    <input type="hidden" id="editProductCurrentImage">

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProductName" class="form-label">Tên sản phẩm <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editProductName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProductCategory" class="form-label">Danh mục <span class="text-danger">*</span></label>
                            <select class="form-select" id="editProductCategory" required>
                                <option value="0">Chọn danh mục...</option>
                                <option value="1">Cupcake</option>
                                <option value="2">Cookie</option>
                                <option value="3">Tart</option>
                                <option value="4">Chocolate</option>
                                <option value="5">Đất màu</option>
                                <option value="6">Len mềm</option>
                                <option value="7">Hạt cườm</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editProductPrice" class="form-label">Giá <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="editProductPrice" min="0" step="1000" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editProductStock" class="form-label">Số lượng tồn kho <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="editProductStock" min="0" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editProductStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="editProductStatus">
                            <option value="In Stock">In Stock</option>
                            <option value="Out of Stock">Out of Stock</option>
                            <option value="Low Stock">Low Stock</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editProductShortDesc" class="form-label">Mô tả ngắn</label>
                        <input type="text" class="form-control" id="editProductShortDesc" placeholder="Mô tả ngắn gọn về sản phẩm...">
                    </div>
                    <div class="mb-3">
                        <label for="editProductDescription" class="form-label">Mô tả chi tiết</label>
                        <textarea class="form-control" id="editProductDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editProductImage" class="form-label">Hình ảnh</label>
                        <input type="file" class="form-control" id="editProductImage" accept="image/*">
                        <div class="mt-2">
                            <img id="editProductImagePreview" src="" alt="Preview" style="max-width: 200px; max-height: 200px; display: none; border-radius: 8px; border: 1px solid #dee2e6;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="handleEditProduct()">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- View Product Modal -->
<div class="modal fade" id="viewProductModal" tabindex="-1" aria-labelledby="viewProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewProductModalLabel">
                    <i class="bi bi-eye me-2"></i>Chi tiết sản phẩm
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5 text-center">
                        <img id="viewProductImage" src="" alt="Product" class="img-fluid rounded" style="max-height: 400px;">
                    </div>
                    <div class="col-md-7">
                        <h4 id="viewProductName" class="mb-3"></h4>
                        <table class="table table-borderless">
                            <tr>
                                <td class="text-muted" style="width: 40%;">ID:</td>
                                <td><strong id="viewProductId"></strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Danh mục:</td>
                                <td><span class="badge bg-primary" id="viewProductCategory"></span></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Giá:</td>
                                <td><strong class="text-primary" id="viewProductPrice"></strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Tồn kho:</td>
                                <td><strong id="viewProductStock"></strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Trạng thái:</td>
                                <td><span id="viewProductStatus"></span></td>
                            </tr>
                        </table>
                        <div class="mt-3">
                            <h6 class="text-muted">Mô tả:</h6>
                            <p id="viewProductDescription" class="text-muted"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="editFromViewBtn">
                    <i class="bi bi-pencil me-2"></i>Chỉnh sửa
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Filter Product Modal -->
<div class="modal fade" id="filterProductModal" tabindex="-1" aria-labelledby="filterProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterProductModalLabel">
                    <i class="bi bi-funnel me-2"></i>Lọc sản phẩm
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="filterProductCategory" class="form-label">Danh mục</label>
                    <select class="form-select" id="filterProductCategory">
                        <option value="">Tất cả</option>
                        <option value="Cupcake">Cupcake</option>
                        <option value="Cookie">Cookie</option>
                        <option value="Tart">Tart</option>
                        <option value="Chocolate">Chocolate</option>
                        <option value="Đất màu">Đất màu</option>
                        <option value="Len mềm">Len mềm</option>
                        <option value="Hạt cườm">Hạt cườm</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="filterProductStatus" class="form-label">Trạng thái</label>
                    <select class="form-select" id="filterProductStatus">
                        <option value="">Tất cả</option>
                        <option value="In Stock">Còn hàng</option>
                        <option value="Out of Stock">Hết hàng</option>
                        <option value="Low Stock">Sắp hết hàng</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="filterProductPriceFrom" class="form-label">Từ giá (₫)</label>
                    <input type="number" class="form-control" id="filterProductPriceFrom" min="0" step="1000">
                </div>
                <div class="mb-3">
                    <label for="filterProductPriceTo" class="form-label">Đến giá (₫)</label>
                    <input type="number" class="form-control" id="filterProductPriceTo" min="0" step="1000">
                </div>
                <div class="mb-3">
                    <label for="filterProductStockFrom" class="form-label">Từ số lượng tồn kho</label>
                    <input type="number" class="form-control" id="filterProductStockFrom" min="0">
                </div>
                <div class="mb-3">
                    <label for="filterProductStockTo" class="form-label">Đến số lượng tồn kho</label>
                    <input type="number" class="form-control" id="filterProductStockTo" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="clearProductFiltersBtn">Xóa bộ lọc</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="applyProductFiltersBtn">Áp dụng</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteProductModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <input type="hidden" id="deleteProductId">

                <p>Bạn có chắc chắn muốn xóa sản phẩm:</p>
                <strong id="deleteProductName"></strong>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button class="btn btn-danger" onclick="handleDeleteProduct()">Xóa</button>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script src="~/admin/js/products.js" asp-append-version="true"></script>
}

